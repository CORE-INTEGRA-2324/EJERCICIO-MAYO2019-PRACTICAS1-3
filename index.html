<html>
    <head>
        <title>Calculadora de CORE - INTEGRA</title>
        <meta charset="utf-8">
        <script type="text/javascript">
            // FUNCIONES ÚTILES PARA LA CALCULADORA
            let acumulador = 0;
            let operador = "";

            const getInputValue = () => {
                return Number(document.getElementById("pantalla").value);
            };

            const setInputValue = (valor) => {
                document.getElementById("pantalla").value = valor;
            }

            const vaciarInput = () => {
                document.getElementById("pantalla").value = "";
            }

            const validNumber = () => {
                if ( Number.isNaN(getInputValue()) ) {
                    acumulador = 0;
                    operador = "";
                    setInputValue("Error");
                    return false;
                }
                return true;
            }

            const rellenarInfo = () => {
                const resultadoInput = getInputValue();
                let mensaje = "";

                if (Number.isNaN(resultadoInput)) {
                    mensaje = "ERROR";
                }

                else {
                    if (resultadoInput < 100) {
                        mensaje = "Info: El resultado es menor que 100";
                    }
                    else if (resultadoInput <= 200) {
                        mensaje = "Info: El resultado está entre 100 y 200";
                    }
                    else {
                        mensaje = "Info: El resultado es superior a 200";
                    }
                }
                document.getElementById("info").innerHTML = mensaje;
            }

            // OPERACIONES UNITARIAS
            const sq = () => {
                if(!validNumber()) return;
                let inputValue = getInputValue();
                setInputValue(inputValue*inputValue);
                rellenarInfo();
            }

            const fact = () => {
                if(!validNumber()) return;
                let inputValue = getInputValue();
                let resultado = 1;
                for (let index = inputValue; index > 1; index--) {
                    resultado *= index;
                }
                setInputValue(resultado);
                rellenarInfo();
            }

            const sqr = () => {
                if(!validNumber()) return;
                let inputValue = getInputValue();
                let resultado = Math.sqrt(inputValue);
                setInputValue(resultado);
                rellenarInfo();
            };

            // OPERACIONES OPCIONALES

            let listaAcumulador = "<ul>"
            let cierreListaAcumulador = "</ul>"

            const addToAcumulatorList = (n) => {
                listaAcumulador += `<li>${n}</li>`;
                let listaCerrada = listaAcumulador + cierreListaAcumulador;
                document.getElementById("valoresAcumulador").innerHTML = listaCerrada;
            }

            const addValorAcumulado = (n) => {
                document.getElementById("valorAcumulado").innerHTML = n;
            }

            // OPERACIONES BINARIAS

            const acumula = n => {
                switch (operador) {
                    case "":
                        acumulador = n;
                        addToAcumulatorList('Inicio:');
                        addToAcumulatorList(acumulador);
                        break;
                    case "+":
                        addToAcumulatorList('+');
                        addToAcumulatorList(n);
                        acumulador += n;
                        addValorAcumulado(acumulador);
                        break;
                    case "-":
                        addToAcumulatorList('-');
                        addToAcumulatorList(n);
                        acumulador -= n;
                        addValorAcumulado(acumulador);
                        break;
                    case "*":
                        addToAcumulatorList('*');
                        addToAcumulatorList(n);
                        acumulador *= n;
                        addValorAcumulado(acumulador);
                        break;
                    case "/":
                        addToAcumulatorList('/');
                        addToAcumulatorList(n);
                        acumulador /= n;
                        addValorAcumulado(acumulador);
                        break;
                }
            }

            const add = () => {
                if(!validNumber()) return;
                acumula(getInputValue());
                operador = "+";
                vaciarInput();
                rellenarInfo();
            }

            const sub = () => {
                if(!validNumber()) return;
                acumula(getInputValue());
                operador = "-";
                vaciarInput();
                rellenarInfo();
            }

            const mul = () => {
                if(!validNumber()) return;
                acumula(getInputValue());
                operador = "*";
                vaciarInput();
                rellenarInfo();
            }
            
            const div = () => {
                if(!validNumber()) return;
                acumula(getInputValue());
                operador = "/";
                vaciarInput();
                rellenarInfo();
            }

            const eq = () => {
                if(!validNumber()) return;
                acumula(getInputValue());
                operador = "";
                setInputValue(acumulador);
                rellenarInfo();
            }

            const onload = () => {
                // OPERACIONES UNITARIAS
                document.getElementById("cuadrado").addEventListener("click", sq);
                document.getElementById("factorial").addEventListener("click", fact);
                document.getElementById("raiz").addEventListener("click", sqr);

                //OPERACIONES BINARIAS
                document.getElementById("suma").addEventListener("click", add);
                document.getElementById("resta").addEventListener("click", sub);
                document.getElementById("multiplicacion").addEventListener("click", mul);
                document.getElementById("division").addEventListener("click", div);
                document.getElementById("igual").addEventListener("click", eq);

                // MANEJO DE PULSACIÓN AL INPUT
                document.getElementById("input_texto").addEventListener("click", vaciarInput);
            }

            window.onload = onload ;
        </script>
    </head>
    <body>
        <h1>Academia INTEGRA</h1>
        <h2 class="cabecera">Calculadora de CORE - INTEGRA</h2>

        <div id="input_texto">
            <label for="pantalla">Número:</label>
            <input type="text" id="pantalla">
        </div>

        <h2 id="info" class="grande" title="Info sobre el número">Info sobre el número</h2>

        <h3 class="cabecera" title="Unitarias">Operaciones unitarias</h3>
        <div class="operaciones">
            <button id="cuadrado"> x<sup>2</sup></button>
            <button id="factorial"> x! </button>
            <button id="raiz"> &#8730 x</button>
        </div>

        <h3 class="cabecera" title="binarias">Operaciones binarias</h3>
        <div class="operaciones">
            <button id="suma"> + </button>
            <button id="resta"> - </button>
            <button id="multiplicacion"> * </button>
            <button id="division"> / </button>
            <button id="igual"> = </button>
        </div>

        <h3 class="cabecera">Acumulador</h3>
        <h4>Valor acumulado: <span id="valorAcumulado">0</span></h4>
        <div id="valoresAcumulador">
        </div>
    </body>
</html>
